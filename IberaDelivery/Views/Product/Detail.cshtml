@model IberaDelivery.Models.Product;
@using IberaDelivery.Models;
@using System.Text.Json
@using System;
@using System.Collections.Generic;
@inject IHttpContextAccessor HttpContextAccessor
@{
    ViewBag.Title = Model.Name;
    
    
}


<div class="container">
    <div class="row">
        <div class="col-sm">
            <div id="carouselExampleControls" class="carousel slide" data-bs-ride="carousel">
            <div class="carousel-inner">
                @{
                    int i = 0;
                }
                @foreach (var item in Model.Images)
                {

                    <div class="carousel-item @(i == 0 ? "active" : "")">
                        <img src="data:image;base64,@System.Convert.ToBase64String(item.Image1)" class="img-thumbnail" />
                    </div>
                    { i++; }



                }

            </div>
            <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleControls"
                data-bs-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Previous</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleControls"
                data-bs-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Next</span>
            </button>
        </div>
        <table>
            <tbody>
                @foreach (var item2 in Model.Images)
                {

                    <th>

                        <img src="data:image;base64,@System.Convert.ToBase64String(item2.Image1)" class="img-thumbnail" style="max-height: 17vh;"/>
                        

                    </th>
                }

            </tbody>
        </table>

        
        
           <div class="display-label">Valorar</div>
            <div class="display-field">
                <form asp-action="Votar">
                    <input type="hidden" name="id" value="@Model.Id"/>
                    @if(ViewBag.Average > 0 && ViewBag.Average < 1){
                        <input class="star" type="radio" name="score" value="1" checked/>
                    }else{
                        <input class="star" type="radio" name="score" value="1"/>
                    }
                    @if(ViewBag.Average > 1 && ViewBag.Average < 2){
                        <input class="star" type="radio" name="score" value="2" checked/>
                    }else{
                        <input class="star" type="radio" name="score" value="2"/>
                    }@if(ViewBag.Average > 2 && ViewBag.Average < 3){
                        <input class="star" type="radio" name="score" value="3" checked/>
                    }else{
                        <input class="star" type="radio" name="score" value="3"/>
                    }@if(ViewBag.Average > 3 && ViewBag.Average < 4){
                        <input class="star" type="radio" name="score" value="4" checked/>
                    }else{
                        <input class="star" type="radio" name="score" value="4"/>
                    }@if(ViewBag.Average > 4 && ViewBag.Average < 5){
                        <input class="star" type="radio" name="score" value="5" checked/>
                    }else{
                        <input class="star" type="radio" name="score" value="5"/>
                    }
                    <br />
                    <input type="submit" value="Votar"/>
                </form>
            </div>

        @if (Model.Valorations.Count > 0)
        {
            <p>Valoration</p>
             <p>@ViewBag.Average</p>
        }
            
        </div>
        <div class="col-sm">
            <h2 class="mb-4 display-4">
                @Html.DisplayFor(Product => Product.Name)
            </h2>
            <div class="mt-1 mb-0 text-muted small">
                @Html.DisplayFor(Product => Product.Category.Name)
            </div>
            <p>
                @Html.DisplayFor(Product => Product.Description)
            </p>
            <div class="col-sm">
                <h4 class="mb-1 me-1">@(Model.Price + @Model.Iva)â‚¬</h4>
                @if (Model.Stock > 0)
                {
                    <a asp-action="AddToCart" asp-route-id="@this.Model.Id" class="btn btn-success btn-lg">Add to cart </a>
                }
                else
                {
                    <button class="btn btn-failure btn-lg" type="button">Product unavailable</button>
                }
            </div>
        </div>
        <div class="col-sm">
            @if (@HttpContextAccessor.HttpContext.Session.GetString("Cart") != null)
            {
                List<Product> list;
                list = new List<Product>();
                list =
                JsonSerializer.Deserialize<List<Product>>(@HttpContextAccessor.HttpContext.Session.GetString("Cart"));
                var totalPrice = new Decimal();
                <div>
                    <h3>Carrito</h3>
                    <ul style="list-style-type: none;">
                        @for (int j = 0; j < list.Count; j++)
                        {
                            <li><b>@list[j].Name</b></li>
                            <li>Price: @(list[j].Price + @list[j].Iva)</li>
                            <li>Quantity: @list[j].Stock</li>
                            totalPrice = totalPrice + (list[j].Price + @list[j].Iva);
                        }
                    </ul>
                    <p>
                        Total price = <b>@totalPrice</b>
                    </p>
                </div>
                <a asp-controller="Checkout" asp-action="Checkout">Checkout</a>
                <a asp-action="ClearCart" asp-route-id="@this.Model.Id">Empty Cart</a>
            }
            else
            {
                <div>
                    Your shopping cart is empty!
                </div>
            }
        </div>
        @using (Html.BeginForm("Create", "Comment"))
        {
        <div class="form-group">
                @Html.Label("Comment here bitch!")
                @Html.Hidden("id", Model.Id)
                @Html.TextBox("com",null, new{@class = "form-control"})
            </div>
        }
        <div>
            @foreach (var item in Model.Comments)
            {
                <p>@item.Contens</p><br>
            }
        </div>
    </div>
</div>